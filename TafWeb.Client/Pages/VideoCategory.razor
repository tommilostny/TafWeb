@page "/kategorie/{CategoryRoute}"
@inject HttpClient Http

@if (categoryDetail is not null)
{
    <h1>@categoryDetail.Name</h1>
    <p>@categoryDetail.ShortDescription</p>
    <p>@categoryDetail.LongDescription</p>
    <hr />
    @foreach (var video in categoryDetail.Videos)
    {
        <a href="video/@video.Route">
            <h2>@video.Title</h2>
            @if (!string.IsNullOrEmpty(video.ThumbnailBase64))
            {
                <img src="@video.ThumbnailBase64" alt="Náhledový obrázek @video.Title" />
            }
            else
            {
                <p>Loading image...</p>
            }
        </a>
    }
}
else
{
    <p>Loading...</p>
}

@code {
    [Parameter]
    public string? CategoryRoute { get; set; }

    VideoCategoryDetailModel? categoryDetail;

    protected override async Task OnParametersSetAsync()
    {
        categoryDetail = null;
        categoryDetail = await Http.GetFromJsonAsync<VideoCategoryDetailModel>(string.Format(ApiEndpoints.VideoCategoryDetailUrl, CategoryRoute));
        if (categoryDetail is not null)
        {
            foreach (var video in categoryDetail.Videos)
            {
                video.ThumbnailBase64 = await Http.GetStringAsync(string.Format(ApiEndpoints.VideoThumbnailUrl, video.Route));
                StateHasChanged();
            }
        }
    }
}
